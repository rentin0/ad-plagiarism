<div class="flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-purple-100 to-pink-100 p-8">
  <div class="mb-8 text-center">
    <h1 class="text-4xl font-bold text-gray-800 mb-2">画像パズルゲーム</h1>
    <p class="text-gray-600">ドラッグ&ドロップでピースを並べ替えて画像を完成させよう！</p>
  </div>

  @if (isCompleted()) {
    <div class="mb-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg animate-bounce">
      <span class="text-xl font-bold">🎉 クリア！おめでとう！</span>
    </div>
  }

  <!-- パズルエリア -->
  <div
    class="relative bg-white p-4 rounded-xl shadow-2xl"
    [style.width.px]="(pieceSize + pieceGap) * gridSize - pieceGap + 32"
    [style.height.px]="(pieceSize + pieceGap) * gridSize - pieceGap + 32"
  >
    <!-- グリッドガイド（薄い線） -->
    <div class="absolute inset-4 pointer-events-none">
      <div class="grid grid-cols-3 h-full">
        @for (i of [0,1,2,3,4,5,6,7,8]; track i) {
          <div class="border border-gray-200"></div>
        }
      </div>
    </div>

    <!-- SVG定義（クリップパス） -->
    <svg class="absolute w-0 h-0">
      <defs>
        @for (piece of pieces(); track piece.id) {
          <clipPath [id]="'puzzle-clip-' + piece.id">
            <path [attr.d]="getPuzzlePath(piece)" />
          </clipPath>
        }
      </defs>
    </svg>

    <!-- パズルピース -->
    @for (piece of pieces(); track piece.id) {
      <div
        cdkDrag
        [cdkDragDisabled]="isCorrectPosition(piece)"
        (cdkDragEnded)="onDragEnded($event, piece)"
        (mousedown)="bringToFront(piece)"
        class="puzzle-piece absolute"
        [class.cursor-move]="!isCorrectPosition(piece)"
        [class.cursor-default]="isCorrectPosition(piece)"
        [style.width.px]="pieceSize + pieceSize * 0.48"
        [style.height.px]="pieceSize + pieceSize * 0.48"
        [style.left.px]="piece.currentPosition.x + 16 - pieceSize * 0.24"
        [style.top.px]="piece.currentPosition.y + 16 - pieceSize * 0.24"
        [style.z-index]="isCorrectPosition(piece) ? 0 : piece.zIndex"
      >
        <div
          class="w-full h-full drop-shadow-lg"
          [style.clip-path]="'url(#puzzle-clip-' + piece.id + ')'"
          [style.background-image]="'url(' + piece.imageUrl + ')'"
          [style.background-position]="getBackgroundPosition(piece)"
          [style.background-size]="getBackgroundSize()"
        ></div>
      </div>
    }
  </div>

  <button
    (click)="reset()"
    class="mt-8 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-colors duration-200"
  >
    リセット
  </button>
</div>
